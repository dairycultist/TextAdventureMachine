<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TextAdventureMachine</title>
    <script type="module">

        const root = "stories/jennyvillage/";

        let scenes = {};
        
        fetch(root + "index.txt")
        .then(file => file.text())
        .then(text => {

            const regex = /\((\w+) ([./\w]+)\) ?{\s*([^{}]*[^\s])\s*}/g;
            let match;
            
            while ((match = regex.exec(text)) !== null) {
                
                scenes[match[1]] = `<img src="${root + match[2]}">`;

                for (const line of match[3].split("\n")) {

                    if (line[0] === "!") {
                        scenes[match[1]] += `<button type="button" onclick="setScene('TEST');">test</button>`;
                    } else {
                        scenes[match[1]] += `<p>#${line}</p>`;
                    }
                }
            }

            setScene("INDEX");
        });

        function setScene(key) {

            if (scenes[key] == undefined) {
                document.getElementById("insert").innerHTML = `Error 404! Page "${key}" not yet implemented!`;
            } else {
                document.getElementById("insert").innerHTML = scenes[key];
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
        body { font-family: "EB Garamond", serif; font-size: 18px; }
        img { width: 100%; display: block; margin: 1em 0; }
        #insert { width: 30em; margin: auto; }
    </style>
</head>
<body>
    <div id="insert"></div>
</body>
</html>
